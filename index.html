<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PROTOTYPE — Demo Prototype</title>
<style>
  /* ========== Design System: CSS Variables ========== */
  :root{
    /* Color Palette */
    --color-bg: #f5f7fb;
    --color-surface: #ffffff;
    --color-primary: #1e4f8f;
    --color-primary-soft: #3b6fb8;
    --color-primary-lighter: #5a89d6;
    --color-primary-bg: #eef5ff;
    --color-accent-success: #10b981;
    --color-accent-success-bg: #d1fae5;
    --color-accent-success-text: #065f46;
    --color-accent-warning: #f59e0b;
    --color-accent-warning-bg: #fef3c7;
    --color-accent-warning-text: #92400e;
    --color-accent-error: #ef4444;
    --color-accent-error-bg: #fee2e2;
    --color-accent-error-text: #991b1b;
    --color-border: #dde3ee;
    --color-text-main: #1f2933;
    --color-text-muted: #6b7280;
    --color-text-light: #94a3b8;
    
    /* Spacing */
    --spacing-xs: 0.375rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 0.75rem;
    --spacing-lg: 1rem;
    --spacing-xl: 1.5rem;
    --spacing-2xl: 2rem;
    
    /* Border Radius */
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-full: 9999px;
    
    /* Shadows */
    --shadow-sm: 0 1px 3px rgba(15, 23, 42, 0.04);
    --shadow-md: 0 4px 12px rgba(15, 23, 42, 0.06);
    --shadow-lg: 0 8px 20px rgba(15, 23, 42, 0.08);
    --shadow-xl: 0 12px 32px rgba(15, 23, 42, 0.12);
    
    /* Typography */
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }
  
  /* ========== Base Styles ========== */
  *, *::before, *::after { box-sizing: border-box; }
  html, body { 
    margin: 0; 
    padding: 0;
    background: var(--color-bg); 
    color: var(--color-text-main); 
    line-height: 1.6;
  }
  
  h1, h2, h3, h4, h5, h6 { 
    margin: 0; 
    font-weight: 600; 
    line-height: 1.3; 
    color: var(--color-text-main);
  }
  h1 { font-size: 2rem; }
  h2 { font-size: 1.5rem; }
  h3 { font-size: 1.25rem; }
  h4 { font-size: 1.125rem; }
  
  /* ========== Utility Classes ========== */
  .muted { color: var(--color-text-muted); font-size: 0.875rem; }
  .text-light { color: var(--color-text-light); }
  .spacer { flex: 1; }
  
  /* ========== Layout ========== */
  .app-shell { 
    max-width: 1280px; 
    margin: 0 auto; 
    padding: var(--spacing-xl) 1.75rem; 
  }
  .container { 
    padding: var(--spacing-xl); 
    max-width: 1280px; 
    margin: 0 auto; 
  }
  .main-layout {
    display: flex;
    gap: var(--spacing-xl);
    align-items: flex-start;
  }
  .main-layout > .main-content { flex: 1; }
  .main-layout > .sidebar { 
    flex: 0 0 280px; 
    position: sticky;
    top: var(--spacing-xl);
  }
  
  /* ========== Header / Navbar ========== */
  header {
    padding: 1.125rem 1.75rem;
    display: flex;
    align-items: center;
    gap: var(--spacing-xl);
    background: var(--color-primary);
    color: white;
    box-shadow: var(--shadow-md);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .brand { 
    display: flex; 
    gap: 0.875rem; 
    align-items: center; 
  }
  .brand .logo { 
    width: 48px;
    height: 48px;
    border-radius: var(--radius-md);
    background: white;
    color: var(--color-primary);
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: 800;
    font-size: 1.125rem;
    box-shadow: var(--shadow-sm);
  }
  .brand-text {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }
  .brand-title { 
    font-size: 1.125rem; 
    font-weight: 700; 
    letter-spacing: 0.025em;
    color: white;
  }
  .brand-subtitle { 
    font-size: 0.75rem; 
    color: rgba(255, 255, 255, 0.8); 
    font-weight: 500;
  }
  .user-info { 
    text-align: right; 
    color: white;
  }
  .user-name { 
    font-size: 0.9375rem; 
    font-weight: 700;
    color: white;
  }
  .user-meta { 
    font-size: 0.75rem; 
    color: rgba(255, 255, 255, 0.85); 
    line-height: 1.4; 
    margin-top: 0.25rem;
  }

  /* ========== Navigation Pills ========== */
  .nav-pills {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
  }
  .nav-pill {
    padding: 0.5rem 1rem;
    border-radius: var(--radius-full);
    border: 1.5px solid var(--color-border);
    background: white;
    color: var(--color-text-main);
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .nav-pill:hover {
    border-color: var(--color-primary);
    background: var(--color-primary-bg);
    color: var(--color-primary);
  }
  .nav-pill.active {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
    box-shadow: var(--shadow-sm);
  }
  
  /* ========== Buttons ========== */
  button { 
    padding: 0.55rem 1.2rem; 
    border-radius: var(--radius-md); 
    border: none; 
    cursor: pointer; 
    font-weight: 600; 
    font-size: 0.9375rem;
    transition: all 0.2s ease;
    font-family: inherit;
  }
  .btn-primary,
  button:not(.secondary):not(.link):not(.btn):not(.close):not(.del):not(.mark-rec):not(.small) { 
    background: var(--color-primary); 
    color: white; 
    box-shadow: var(--shadow-sm);
  }
  .btn-primary:hover,
  button:not(.secondary):not(.link):not(.btn):not(.close):not(.del):not(.mark-rec):not(.small):hover {
    background: var(--color-primary-soft);
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
  }
  button.secondary { 
    background: var(--color-text-main); 
    color: white;
    box-shadow: var(--shadow-sm);
  }
  button.secondary:hover {
    background: #374151;
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
  }
  button.link { 
    background: transparent; 
    color: var(--color-primary); 
    box-shadow: none; 
    padding: 0.25rem 0.5rem;
    font-weight: 600;
  }
  button.link:hover {
    background: var(--color-primary-bg);
    text-decoration: underline;
    transform: none;
  }
  button:disabled { 
    opacity: 0.5; 
    cursor: not-allowed; 
  }
  button:disabled:hover {
    transform: none;
    box-shadow: var(--shadow-sm);
  }
  .btn.small { 
    padding: 0.375rem 0.75rem; 
    font-size: 0.8125rem; 
    border-radius: var(--radius-sm); 
  }
  
  /* ========== Forms ========== */
  input, select, textarea { 
    border: 1.5px solid var(--color-border); 
    padding: 0.55rem 0.75rem; 
    border-radius: var(--radius-md);
    background: white;
    color: var(--color-text-main);
    font-family: inherit;
    font-size: 0.9375rem;
    transition: all 0.2s ease;
  }
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px var(--color-primary-bg);
  }
  label {
    display: inline-block;
    font-weight: 600;
    color: var(--color-text-main);
    font-size: 0.875rem;
    margin-bottom: 0.375rem;
  }
  .form-row {
    display: flex;
    gap: var(--spacing-lg);
    align-items: flex-start;
  }
  .form-row > * { flex: 1; }
  
  /* ========== Cards ========== */
  .card { 
    background: var(--color-surface); 
    border-radius: var(--radius-lg); 
    box-shadow: var(--shadow-lg); 
    padding: 1.5rem 1.75rem;
    border: 1px solid rgba(226, 232, 240, 0.6);
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
  }
  .card-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text-main);
    margin: 0;
  }
  
  .grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
    gap: var(--spacing-xl); 
  }
  .big { font-size: 2rem; font-weight: 700; }
  #lists { margin-top: var(--spacing-xl); }
  
  /* ========== Toolbar ========== */
  .toolbar { 
    display: flex; 
    align-items: center; 
    gap: var(--spacing-md); 
    flex-wrap: wrap; 
  }
  
  /* ========== Step Progress Bar ========== */
  .steps { 
    display: flex; 
    gap: var(--spacing-sm); 
    margin: var(--spacing-xl) 0; 
    flex-wrap: wrap;
    background: white;
    padding: var(--spacing-lg);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
  }
  .step { 
    padding: 0.65rem 1rem; 
    border-radius: var(--radius-full); 
    background: var(--color-bg); 
    color: var(--color-text-muted); 
    font-weight: 600; 
    cursor: pointer; 
    font-size: 0.8125rem;
    border: 2px solid transparent;
    transition: all 0.2s ease;
    position: relative;
  }
  .step:hover {
    background: var(--color-primary-bg);
    color: var(--color-primary);
  }
  .step.active { 
    background: var(--color-primary); 
    color: white;
    box-shadow: var(--shadow-md);
    border-color: var(--color-primary);
  }
  .step.done {
    background: var(--color-accent-success-bg);
    color: var(--color-accent-success-text);
    border-color: var(--color-accent-success);
  }
  .step.done::after {
    content: "✓";
    position: absolute;
    top: -4px;
    right: -4px;
    width: 18px;
    height: 18px;
    background: var(--color-accent-success);
    color: white;
    border-radius: 50%;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
  }

  /* ========== Tables ========== */
  table { 
    width: 100%; 
    border-collapse: collapse; 
  }
  thead tr {
    background: var(--color-primary-bg);
    border-bottom: 2px solid var(--color-primary);
  }
  th, td { 
    text-align: left; 
    padding: 0.875rem 1rem; 
    border-bottom: 1px solid var(--color-border); 
  }
  th {
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text-main);
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }
  tbody tr {
    transition: background 0.15s ease;
  }
  tbody tr:nth-child(even) {
    background: rgba(248, 250, 252, 0.5);
  }
  tbody tr:hover {
    background: var(--color-primary-bg);
  }
  
  /* ========== Status Pills / Chips ========== */
  .chip, .status-pill { 
    padding: 0.375rem 0.75rem; 
    border-radius: var(--radius-full); 
    font-weight: 600; 
    font-size: 0.75rem; 
    display: inline-flex; 
    align-items: center; 
    gap: 0.375rem;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }
  .ok, .status-completed { 
    background: var(--color-accent-success-bg); 
    color: var(--color-accent-success-text); 
  }
  .miss, .status-pending, .status-failed { 
    background: var(--color-accent-error-bg); 
    color: var(--color-accent-error-text); 
  }
  .warn, .status-in-progress, .status-onsite { 
    background: var(--color-accent-warning-bg); 
    color: var(--color-accent-warning-text); 
  }
  .info { 
    background: #dbeafe; 
    color: #1e40af; 
  }

  /* ========== Progress Bars ========== */
  .bar { 
    height: 10px; 
    background: var(--color-border); 
    border-radius: var(--radius-full); 
    overflow: hidden; 
  }
  .bar > i { 
    display: block; 
    height: 100%; 
    background: linear-gradient(90deg, var(--color-primary-lighter), var(--color-primary));
    transition: width 0.3s ease;
  }
  
  /* ========== Pills (team members, tags) ========== */
  .pill { 
    display: inline-flex; 
    align-items: center; 
    gap: var(--spacing-xs); 
    padding: 0.375rem 0.75rem; 
    background: var(--color-primary-bg); 
    border-radius: var(--radius-full); 
    font-size: 0.8125rem; 
    margin: 0.25rem 0.375rem 0.25rem 0;
    color: var(--color-primary);
    font-weight: 600;
  }
  .pill b { font-weight: 700; }

  /* ========== Flexbox Utilities ========== */
  .row { 
    display: flex; 
    gap: var(--spacing-lg); 
    flex-wrap: wrap; 
    align-items: stretch;
  }
  .col { 
    flex: 1; 
    min-width: 260px; 
  }

  /* ========== Login Page ========== */
  .login-wrap {
    min-height: 100vh; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    position: relative; 
    padding: 2rem; 
    background: linear-gradient(135deg, #e0f2fe 0%, #f5f7fb 50%, #ede9fe 100%);
  }
  .login-card {
    width: min(480px, 94vw);
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    padding: 2.5rem;
  }
  .login-card h1 { 
    font-size: 1.875rem; 
    margin: 0 0 0.5rem 0; 
    font-weight: 700; 
    letter-spacing: 0.025em; 
    color: var(--color-primary); 
  }
  .login-card .tagline { 
    margin-top: 0.375rem; 
    color: var(--color-text-muted); 
    font-size: 0.9375rem;
    margin-bottom: 1.5rem;
  }
  .login-card label { 
    display: block; 
    font-weight: 600; 
    margin-top: 1.125rem;
    margin-bottom: 0.375rem;
    color: var(--color-text-main);
    font-size: 0.875rem;
  }
  .login-card input { 
    width: 100%; 
    padding: 0.75rem 1rem; 
    border: 1.5px solid var(--color-border); 
    border-radius: var(--radius-md); 
    margin-top: 0.25rem; 
    background: white;
    font-size: 0.9375rem;
  }
  .login-card input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px var(--color-primary-bg);
  }
  .login-actions { 
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
    gap: var(--spacing-lg); 
    margin-top: 1.5rem; 
  }
  .login-actions .btn,
  .login-card .btn { 
    padding: 0.75rem 1.5rem; 
    border-radius: var(--radius-md); 
    border: none; 
    background: var(--color-primary); 
    color: white; 
    font-weight: 700; 
    cursor: pointer;
    font-size: 0.9375rem;
    box-shadow: var(--shadow-md);
    transition: all 0.2s ease;
  }
  .login-actions .btn:hover,
  .login-card .btn:hover {
    background: var(--color-primary-soft);
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }
  .login-actions .link { 
    background: transparent; 
    border: none; 
    color: var(--color-primary); 
    cursor: pointer; 
    font-weight: 600;
    font-size: 0.875rem;
    padding: 0.5rem;
  }
  .login-actions .link:hover {
    text-decoration: underline;
  }
  .login-footer-text {
    text-align: center;
    font-size: 0.8125rem;
    color: var(--color-text-light);
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--color-border);
  }


  /* ========== Config Tabs ========== */
  .tabs { 
    display: flex; 
    gap: var(--spacing-sm); 
    margin: var(--spacing-xl) 0; 
    flex-wrap: wrap;
    background: white;
    padding: var(--spacing-md);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
  }
  .tab { 
    padding: 0.625rem 1rem; 
    border-radius: var(--radius-md); 
    background: var(--color-bg); 
    border: 1.5px solid transparent; 
    cursor: pointer; 
    font-weight: 600; 
    color: var(--color-text-main); 
    font-size: 0.875rem;
    transition: all 0.2s ease;
  }
  .tab:hover {
    background: var(--color-primary-bg);
    color: var(--color-primary);
    border-color: var(--color-primary);
  }
  .tab.active { 
    background: var(--color-primary); 
    color: white; 
    border-color: var(--color-primary); 
    box-shadow: var(--shadow-md);
  }

  /* ========== Footer ========== */
  .footer {
    text-align: center;
    margin-top: 3rem;
    padding: 1.5rem;
    color: var(--color-text-light);
    font-size: 0.8125rem;
    font-weight: 400;
    font-family: inherit;
    border-top: 1px solid var(--color-border);
  }

  /* ========== Config Root Spacing ========== */
  #config-root { margin-top: var(--spacing-xl); }

/* ========== Modal (final report) ========== */
.modal { 
  position: fixed; 
  inset: 0; 
  display: none; 
  align-items: center; 
  justify-content: center; 
  background: rgba(15, 23, 42, 0.6); 
  z-index: 1200;
  backdrop-filter: blur(4px);
}
.modal.show { display: flex; }
.modal .dialog { 
  width: 94%; 
  max-width: 960px; 
  background: white; 
  border-radius: var(--radius-xl); 
  padding: 1.75rem; 
  box-shadow: var(--shadow-xl);
  border: 1px solid var(--color-border);
}
.modal .dialog header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: var(--spacing-lg);
  padding-bottom: var(--spacing-lg);
  border-bottom: 2px solid var(--color-border);
}
.modal .dialog .content { 
  height: 560px; 
  overflow: auto; 
  border: 1px solid var(--color-border); 
  border-radius: var(--radius-md); 
  padding: var(--spacing-lg); 
  background: var(--color-bg);
}
.modal .close { 
  background: transparent; 
  border: none; 
  font-weight: 700; 
  cursor: pointer; 
  color: var(--color-text-main);
  font-size: 1.5rem;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  transition: all 0.2s ease;
}
.modal .close:hover {
  background: var(--color-accent-error-bg);
  color: var(--color-accent-error);
}

  /* ========== Step Checklist Layout ========== */
  .step-layout { 
    display: flex; 
    gap: var(--spacing-xl); 
    align-items: flex-start; 
  }
  .step-main { flex: 1; }
  .step-tasks { 
    flex: 0 0 280px; 
    background: var(--color-primary-bg);
    border: 1.5px solid var(--color-primary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    font-size: 0.875rem;
    position: sticky;
    top: calc(64px + var(--spacing-xl));
  }
  .step-tasks h4 {
    margin: 0 0 var(--spacing-md) 0;
    color: var(--color-primary);
    font-size: 1rem;
    font-weight: 700;
  }
  .task-list { 
    list-style: none; 
    padding-left: 0; 
    margin: var(--spacing-md) 0 0; 
  }
  .task-list li { 
    margin-bottom: var(--spacing-md);
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm);
  }
  .task-list li label {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm);
    cursor: pointer;
    font-weight: 500;
    font-size: 0.875rem;
  }
  .task-list input[type="checkbox"] {
    margin-top: 0.125rem;
    cursor: pointer;
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  /* ========== Task Status Icons (Step 1) ========== */
  .task-item {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
    font-weight: 500;
  }
  .task-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    font-size: 0.6875rem;
    font-weight: 700;
    flex-shrink: 0;
    margin-top: 0.125rem;
  }
  .task-icon.status-pending {
    background: var(--color-accent-error-bg);
    color: var(--color-accent-error);
  }
  .task-icon.status-done {
    background: var(--color-accent-success);
    color: white;
  }

  /* ========== Stage Completion Chip ========== */
  .stage-chip { 
    margin-left: var(--spacing-md); 
    display: inline-block; 
  }
  .stage-chip.chip { 
    background: var(--color-accent-success-bg); 
    color: var(--color-accent-success-text);
    font-weight: 700;
  }

  /* ========== Insurer Portal Styles ========== */
  .kpi-grid { 
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: var(--spacing-lg); 
    margin-top: var(--spacing-lg); 
  }
  .kpi-card { 
    padding: var(--spacing-lg); 
    text-align: left;
    background: linear-gradient(135deg, var(--color-primary-bg) 0%, white 100%);
    border: 1.5px solid var(--color-primary);
    transition: all 0.2s ease;
  }
  .kpi-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }
  .kpi-title { 
    color: var(--color-text-muted); 
    font-weight: 600; 
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }
  .kpi-value { 
    font-size: 2rem; 
    font-weight: 700; 
    color: var(--color-primary); 
    margin-top: var(--spacing-sm); 
  }
  .flex-row { 
    display: flex; 
    gap: var(--spacing-xl); 
    align-items: flex-start; 
    margin-top: var(--spacing-lg); 
  }

  /* ========== Insurer-specific Tab Styles ========== */
  .insurer-tabs { 
    display: flex; 
    gap: var(--spacing-xs); 
    margin-bottom: var(--spacing-lg); 
    border-bottom: 2px solid var(--color-border); 
    padding-bottom: 0;
  }
  .insurer-tab { 
    padding: 0.75rem 1.25rem; 
    border-radius: var(--radius-md) var(--radius-md) 0 0; 
    background: transparent; 
    cursor: pointer; 
    font-weight: 600; 
    font-size: 0.875rem; 
    color: var(--color-text-muted); 
    transition: all 0.2s;
    border: 2px solid transparent;
    border-bottom: none;
    position: relative;
    bottom: -2px;
  }
  .insurer-tab:hover { 
    background: var(--color-primary-bg); 
    color: var(--color-primary);
  }
  .insurer-tab.active { 
    background: white; 
    color: var(--color-primary);
    border-color: var(--color-border);
    border-bottom-color: white;
    font-weight: 700;
  }
  .insurer-tab-panel { display: none; }
  .insurer-tab-panel.active { display: block; }

  /* ========== Toggle Switch ========== */
  .switch {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 24px;
  }
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--color-border);
    transition: 0.3s;
    border-radius: var(--radius-full);
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
    box-shadow: var(--shadow-sm);
  }
  input:checked + .slider {
    background-color: var(--color-primary);
  }
  input:checked + .slider:before {
    transform: translateX(24px);
  }

  /* ========== Field Groups (Details/Summary) ========== */
  details.field-group {
    margin-bottom: var(--spacing-md);
    border: 1.5px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    background: var(--color-bg);
  }
  details.field-group summary {
    font-weight: 600;
    color: var(--color-primary);
    cursor: pointer;
    user-select: none;
    padding: var(--spacing-xs);
    margin: calc(-1 * var(--spacing-md));
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
  }
  details.field-group summary:hover {
    background: var(--color-primary-bg);
  }
  details.field-group[open] summary {
    margin-bottom: var(--spacing-md);
    border-bottom: 1.5px solid var(--color-border);
  }
  .field-list {
    padding: var(--spacing-md) 0 0;
  }
  .field-list label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
    font-weight: 500;
    cursor: pointer;
  }
  .field-list input[type="checkbox"] {
    cursor: pointer;
    width: 16px;
    height: 16px;
  }

  /* ========== Page Title Headers ========== */
  .page-header {
    margin-bottom: var(--spacing-2xl);
  }
  .page-header h2 {
    color: var(--color-primary);
    margin-bottom: var(--spacing-xs);
  }
  .page-header .muted {
    margin-top: var(--spacing-xs);
  }

  /* ========== Responsive Adjustments ========== */
  @media (max-width: 1024px) {
    .step-tasks {
      position: static;
      flex: 1 1 100%;
      max-width: none;
    }
    .step-layout {
      flex-direction: column;
    }
    .main-layout {
      flex-direction: column;
    }
    .main-layout > .sidebar {
      flex: 1 1 100%;
      position: static;
    }
  }
  @media (max-width: 768px) {
    .app-shell, .container {
      padding: var(--spacing-lg);
    }
    header {
      padding: var(--spacing-lg);
    }
    .brand-text {
      display: none;
    }
    .steps {
      flex-wrap: wrap;
    }
    .nav-pills {
      width: 100%;
    }
  }
</style>
</head>
<body>

<!-- ===== Login ===== -->
<section id="login" class="login-wrap">
  <div class="login-card">
    <h1>PROTOTYPE</h1>
    <div class="tagline">Demo Prototype<br></div>
    <label>Username</label>
    <input type="email" id="email" placeholder="Enter your username">
    <label>Password</label>
    <input type="password" id="password" placeholder="Enter your password">
    <div class="login-actions">
      <button id="login-btn" type="button" class="btn">Login</button>
      <button id="forgot" type="button" class="link">Forgot Password?</button>
    </div>
    <div class="login-footer-text">Developed by InsurTech Team </div>
  </div>
</section>

<!-- ===== App ===== -->
<section id="app-root" style="display:none;">
  <header>
    <div class="brand">
      <div class="logo">P</div>
      <div class="brand-text">
        <div class="brand-title">PROTOTYPE</div>
        <div class="brand-subtitle">Demo Prototype</div>
      </div>
    </div>
    <div class="spacer"></div>
    <div class="user-info">
      <div class="user-name">User-Name</div>
      <div class="user-meta">Logged in: 12-Nov-2025 11:15 | IP: 192.168.1.108</div>

      <!-- Role switch and Logout on same line -->
      <div style="margin-top:0.75rem; display:flex; align-items:center; gap:1rem;">
        <label for="role-switch" style="font-size:0.8125rem; margin:0; color:rgba(255,255,255,0.9);">View as:</label>
        <select id="role-switch" style="padding:0.375rem 0.625rem; border-radius:0.375rem; border:1.5px solid rgba(255,255,255,0.3); background:rgba(255,255,255,0.1); color:white; font-size:0.8125rem; font-weight:600;">
          <option value="regulator" selected style="color:#1f2933; background:white;">Regulator</option>
          <option value="insurer" style="color:#1f2933; background:white;">Insurer</option>
        </select>
        <button id="logout-btn" type="button" class="link" style="margin:0; font-size:0.8125rem; color:white; padding:0.25rem 0.5rem;">Logout</button>
      </div>
    </div>
  </header>

  <main class="app-shell" id="app">
  <div id="regulator-view">
    <!-- Supervision toolbar: hidden by default, shown only when Home -> Supervision tab is active -->
    <div id="supervision-toolbar" class="toolbar" style="display:none; margin-bottom:var(--spacing-xl); padding-bottom:var(--spacing-lg); border-bottom:2px solid var(--color-border);">
      <button id="btn-start" type="button">Start New Inspection</button>
      <button id="btn-view-ongoing" type="button">View Ongoing</button>
      <button id="btn-view-completed" type="button">View Completed</button>
      <button id="btn-config" type="button">Configure</button>
    </div>

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:var(--spacing-xl);">
      <div class="nav-pills">
        <button id="btn-home" type="button" class="nav-pill active">Home</button>
      </div>
      <h2 style="margin:0; color:var(--color-text-muted); font-size:1.25rem;"></h2>
    </div>

    <!-- HOME -->
    <div id="home" style="display:none; min-height:220px;">
      <div class="card">
        <div class="tabs">
          <div class="tab active" data-home="rbs">Risk Based Supervision</div>
          <div class="tab" data-home="supervision">Supervision</div>
          <div class="tab" data-home="enforcement">Enforcement</div>
          <div class="tab" data-home="grievance">Grievance Intelligence</div>
        </div>

        <div id="home-panels" style="margin-top:var(--spacing-lg);">
          <div id="home-rbs" class="card" style="display:block; box-shadow:var(--shadow-sm); border:1px solid var(--color-border);">
            <h4 style="margin-top:0; color:var(--color-primary);">Risk Based Supervision</h4>
            <div class="muted">Placeholder view for Risk Based Supervision.</div>
          </div>

          <div id="home-supervision" class="card" style="display:none; box-shadow:var(--shadow-sm); border:1px solid var(--color-border);">
            <h4 style="margin-top:0; color:var(--color-primary);">Supervision</h4>
            <div class="muted">Quick access to supervision features.</div>
            <!-- removed duplicated internal toolbar (buttons moved to #supervision-toolbar) -->
            <div style="margin-top:var(--spacing-md);" class="muted">Click any action to open the supervision workspace.</div>
          </div>

          <div id="home-enforcement" class="card" style="display:none; box-shadow:var(--shadow-sm); border:1px solid var(--color-border);">
            <h4 style="margin-top:0; color:var(--color-primary);">Enforcement</h4>
            <div class="muted">Placeholder view for Enforcement.</div>
          </div>

          <div id="home-grievance" class="card" style="display:none; box-shadow:var(--shadow-sm); border:1px solid var(--color-border);">
            <h4 style="margin-top:0; color:var(--color-primary);">Grievance Intelligence</h4>
            <div class="muted">Placeholder view for Grievance Intelligence.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- LISTS (default) -->
    <div id="lists" style="margin-top:var(--spacing-xl);">
      <div class="card">
        <div class="card-header">
          <h3 id="list-title" class="card-title">Completed Inspections</h3>
          <div class="muted">Demo data</div>
        </div>
        <table style="margin-top:var(--spacing-md);">
          <thead><tr><th>ID</th><th>Insurer</th><th>Period</th><th>Status</th><th>Owner</th><th>Final Report</th></tr></thead>
          <tbody id="list-body"></tbody>
        </table>
      </div>
    </div>

    <!-- FLOW -->
    <div id="flow" style="display:none;">
      <div class="steps" id="steps">
        <div class="step active" data-step="1">1. Create Inspection</div>
        <div class="step" data-step="2">2. Data Fetch (Status)</div>
        <div class="step" data-step="3">3. Data Validation</div>
        <div class="step" data-step="4">4. Regulatory Check</div>
        <div class="step" data-step="5">5. Analytics & Risk-Based Sampling</div>
        <div class="step" data-step="6">6. Onsite Inspection Support</div>
        <div class="step" data-step="7">7. Observations & Report</div>
      </div>

      <div id="area">
        <!-- Step 1 -->
        <div class="card" id="step-1">
          <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Create New Inspection <span class="chip stage-chip" data-step="1" style="display:none;">Stage completed</span></h3>
          <div class="step-layout">
            <div class="step-main">
              <div class="muted" style="margin-bottom:var(--spacing-lg);">Fill basic info and assign team.</div>
              <div style="margin-bottom:var(--spacing-xl);">
                <label>Insurer</label>
                <select id="insurer" style="width:100%; max-width:480px; margin-top:var(--spacing-xs);">
                  <option value="">-- Select Insurer --</option>
                  <option>LIC</option><option>ICICI Lombard</option><option>SBI Life</option><option>HDFC Ergo</option>
                </select>
              </div>
              <div class="form-row" style="max-width:480px;">
                <div style="flex:1;">
                  <label>From Date</label>
                  <input type="date" id="from" style="width:100%; margin-top:var(--spacing-xs);">
                </div>
                <div style="flex:1;">
                  <label>To Date</label>
                  <input type="date" id="to" style="width:100%; margin-top:var(--spacing-xs);">
                </div>
              </div>
              <!-- Data category controls (unchanged markup kept) -->
              <div style="margin-top:var(--spacing-xl);">
                <label>Data Category (select one or more)</label>
                <div style="margin-top:var(--spacing-md); max-width:880px;">
                  <!-- Mode chooser -->
                  <div style="margin-bottom:var(--spacing-lg); display:flex; gap:var(--spacing-xl); flex-wrap:wrap;">
                    <label style="font-weight:600; display:flex; align-items:center; gap:var(--spacing-sm); cursor:pointer;">
                      <input type="radio" name="tpl-mode" id="mode-template" checked style="cursor:pointer;"> Use inspection template
                    </label>
                    <label style="font-weight:600; display:flex; align-items:center; gap:var(--spacing-sm); cursor:pointer;">
                      <input type="radio" name="tpl-mode" id="mode-manual" style="cursor:pointer;"> Choose data category and fields manually
                    </label>
                  </div>
                  <div id="templateSection">
                    <div id="template-control" style="margin-bottom:var(--spacing-md);">
                      <label style="display:block; font-weight:600; margin-bottom:var(--spacing-xs);">Inspection template</label>
                      <select id="template-select" style="width:100%; padding:0.625rem 0.75rem; border-radius:var(--radius-md); border:1.5px solid var(--color-border); background:white;">
                        <option value="">-- Select template --</option>
                        <option value="claims_basic">Claims – Basic Claim Inspection</option>
                        <option value="claims_advanced">Claims – Advanced Fraud Review</option>
                        <option value="sales_perf">Sales – Agent Performance Review</option>
                      </select>
                    </div>
                  </div>
                  <div id="manualSection" style="display:none;">
                    <div id="manual-controls">
                      <select id="data-cats" multiple size="4" style="width:100%; padding:0.625rem 0.75rem; border-radius:var(--radius-md); border:1.5px solid var(--color-border); background:white;">
                        <option value="claims">Claims</option>
                        <option value="under">Underwriting</option>
                        <option value="griev">Grievances</option>
                        <option value="sales">Sales/Agents</option>
                      </select>
                    </div>
                    <div id="fields-container" style="margin-top:10px;">
                      <details id="fields-claims" class="field-group" style="display:none;">
                        <summary>Claims fields</summary>
                        <div class="field-list">
                          <label><input type="checkbox" class="field" data-cat="claims" value="claim_id" checked> Claim ID</label><br/>
                          <label><input type="checkbox" class="field" data-cat="claims" value="policy_number" checked> Policy Number</label><br/>
                          <label><input type="checkbox" class="field" data-cat="claims" value="claim_date"> Claim Date</label><br/>
                          <label><input type="checkbox" class="field" data-cat="claims" value="claim_amount"> Claim Amount</label><br/>
                          <label><input type="checkbox" class="field" data-cat="claims" value="settlement_date"> Settlement Date</label><br/>
                        </div>
                      </details>
                      <details id="fields-under" class="field-group" style="display:none;">
                        <summary>Underwriting fields</summary>
                        <div class="field-list">
                          <label><input type="checkbox" class="field" data-cat="under" value="policy_number" checked> Policy Number</label><br/>
                          <label><input type="checkbox" class="field" data-cat="under" value="inception_date"> Inception Date</label><br/>
                          <label><input type="checkbox" class="field" data-cat="under" value="sum_assured"> Sum Assured</label><br/>
                          <label><input type="checkbox" class="field" data-cat="under" value="product_code"> Product Code</label><br/>
                          <label><input type="checkbox" class="field" data-cat="under" value="underwriting_decision"> Underwriting Decision</label><br/>
                        </div>
                      </details>
                      <details id="fields-griev" class="field-group" style="display:none;">
                        <summary>Grievances fields</summary>
                        <div class="field-list">
                          <label><input type="checkbox" class="field" data-cat="griev" value="complaint_id" checked> Complaint ID</label><br/>
                          <label><input type="checkbox" class="field" data-cat="griev" value="received_date"> Received Date</label><br/>
                          <label><input type="checkbox" class="field" data-cat="griev" value="category"> Complaint Category</label><br/>
                          <label><input type="checkbox" class="field" data-cat="griev" value="resolution_date"> Resolution Date</label><br/>
                          <label><input type="checkbox" class="field" data-cat="griev" value="status"> Complaint Status</label><br/>
                        </div>
                      </details>
                      <details id="fields-sales" class="field-group" style="display:none;">
                        <summary>Sales / Agents fields</summary>
                        <div class="field-list">
                          <label><input type="checkbox" class="field" data-cat="sales" value="agent_id" checked> Agent ID</label><br/>
                          <label><input type="checkbox" class="field" data-cat="sales" value="agent_name"> Agent Name</label><br/>
                          <label><input type="checkbox" class="field" data-cat="sales" value="channel"> Channel</label><br/>
                          <label><input type="checkbox" class="field" data-cat="sales" value="sales_date"> Sales Date</label><br/>
                          <label><input type="checkbox" class="field" data-cat="sales" value="commission"> Commission Amount</label><br/>
                        </div>
                      </details>
                    </div>
                  </div>
                </div>
              </div>
              <div style="margin-top:var(--spacing-xl);">
                <label>Assign Team</label>
                <div id="team-list" style="margin-top:var(--spacing-md); display:flex; flex-wrap:wrap; gap:var(--spacing-lg);">
                  <label style="display:flex; align-items:center; gap:var(--spacing-sm); cursor:pointer; font-weight:500;">
                    <input type="checkbox" class="team" value="A. Kumar" style="cursor:pointer;"> A. Kumar
                  </label>
                  <label style="display:flex; align-items:center; gap:var(--spacing-sm); cursor:pointer; font-weight:500;">
                    <input type="checkbox" class="team" value="R. Singh" style="cursor:pointer;"> R. Singh
                  </label>
                  <label style="display:flex; align-items:center; gap:var(--spacing-sm); cursor:pointer; font-weight:500;">
                    <input type="checkbox" class="team" value="P. Rao" style="cursor:pointer;"> P. Rao
                  </label>
                  <label style="display:flex; align-items:center; gap:var(--spacing-sm); cursor:pointer; font-weight:500;">
                    <input type="checkbox" class="team" value="S. Iyer" style="cursor:pointer;"> S. Iyer
                  </label>
                </div>
                <div id="team-pills" style="margin-top:var(--spacing-md);"></div>
              </div>
              <div style="margin-top:var(--spacing-2xl); display:flex; align-items:center; gap:var(--spacing-lg); flex-wrap:wrap;">
                <button id="create-inspection" type="button" class="secondary">Create Inspection</button>
                <div class="muted">Team will be notified (simulated).</div>
              </div>
            </div>
            <aside class="step-tasks" data-step="1">
              <h4>Tasks in this stage</h4>
              <ul class="task-list" id="step1-tasks">
                <li class="task-item" data-task="insurer">
                  <span class="task-icon status-pending">✕</span>
                  <span>Select insurer</span>
                </li>
                <li class="task-item" data-task="dates">
                  <span class="task-icon status-pending">✕</span>
                  <span>Set inspection date range</span>
                </li>
                <li class="task-item" data-task="scope">
                  <span class="task-icon status-pending">✕</span>
                  <span>Choose data categories / fields</span>
                </li>
                <li class="task-item" data-task="team">
                  <span class="task-icon status-pending">✕</span>
                  <span>Assign inspection team</span>
                </li>
                <li class="task-item" data-task="create">
                  <span class="task-icon status-pending">✕</span>
                  <span>Click "Create Inspection"</span>
                </li>
              </ul>
            </aside>
          </div>
        </div>

        <!-- Step 2: Data Fetch -->
        <div class="card" id="step-2" style="display:none; margin-top:var(--spacing-xl);">
          <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Data Fetch (Status) <span class="chip stage-chip" data-step="2" style="display:none;">Stage completed</span></h3>
          <div class="step-layout">
            <div class="step-main">
              <div class="row" style="margin-top:var(--spacing-lg);">
                <div class="col">
                  <div style="font-weight:700; margin-bottom:var(--spacing-md); color:var(--color-primary);">Checklist</div>
                  <div id="chk-fields" class="chip miss" style="margin-bottom:var(--spacing-sm);"><span class="tick">✗</span> All requested fields fetched</div>
                  <div id="chk-period" class="chip warn"><span class="tick">!</span> Requested time period fetched</div>
                  <div style="margin-top:var(--spacing-xl); display:flex; gap:var(--spacing-md); flex-wrap:wrap;">
                    <button id="btn-fetch-all" type="button">Re-fetch All</button>
                    <button id="btn-proceed3" type="button" class="secondary" disabled>Proceed to Validation</button>
                  </div>
                </div>
                <div class="col">
                  <div style="font-weight:700; margin-bottom:6px;">Dataset status</div>
                  <table>
                    <thead><tr><th>Dataset</th><th>Status</th><th>Last Fetch</th></tr></thead>
                    <tbody id="ds-status">
                      <tr><td>Claims</td><td><span class="chip ok">✓ Fetched</span></td><td>12-Nov-2025 10:05</td></tr>
                      <tr><td>Underwriting</td><td><span class="chip miss">✗ Missing</span></td><td>—</td></tr>
                      <tr><td>Grievances</td><td><span class="chip miss">✗ Missing</span></td><td>—</td></tr>
                      <tr><td>Sales/Agents</td><td><span class="chip miss">✗ Missing</span></td><td>—</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div style="margin-top:12px;">
                <div style="font-weight:700; margin-bottom:6px;">Insurer submissions</div>
                <table>
                  <thead><tr><th>Dataset</th><th>Period</th><th>Submission</th><th>Status</th></tr></thead>
                  <tbody>
                    <tr><td>Claims</td><td>2025-Q3</td><td>claims_2025_q3.xlsx</td><td><span class="chip ok">✓ Received</span></td></tr>
                    <tr><td>Underwriting</td><td>—</td><td>—</td><td><span class="chip miss">✗ Not received</span></td></tr>
                    <tr><td>Grievances</td><td>—</td><td>—</td><td><span class="chip miss">✗ Not received</span></td></tr>
                    <tr><td>Sales/Agents</td><td>—</td><td>—</td><td><span class="chip miss">✗ Not received</span></td></tr>
                  </tbody>
                </table>
              </div>
            </div>
            <aside class="step-tasks" data-step="2">
              <h4>Tasks in this stage</h4>
              <ul class="task-list">
                <li><label><input type="checkbox" class="task-checkbox" data-step="2"> Review DSF status for all datasets</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="2"> Confirm datasets received from insurer</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="2"> Trigger re-fetch for missing datasets</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="2"> Check insurer submissions table</label></li>
              </ul>
            </aside>
          </div>
        </div>

        <!-- Step 3: Data Validation -->
        <div class="card" id="step-3" style="display:none; margin-top:var(--spacing-xl);">
          <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Data Validation <span class="chip stage-chip" data-step="3" style="display:none;">Stage completed</span></h3>
          <div class="step-layout">
            <div class="step-main">
              <div class="muted">Automatic checks for structure, completeness, mandatory fields, and formats.</div>
              <div class="row" style="margin-top:10px;">
                <div class="col">
                  <div class="card" style="padding:12px;">
                    <div><b>Records processed:</b> <span id="val-rows">12,432</span></div>
                    <div style="margin-top:6px;"><b>Exceptions:</b> <span id="val-exc">27</span></div>
                    <div style="margin-top:6px;"><b>High severity:</b> <span id="val-high">5</span> <span class="chip miss">High</span></div>
                    <div style="margin-top:8px;">
                      <button id="btn-exception" type="button">Download Exception Report</button>
                      <button id="btn-req-fix" type="button" class="secondary">Request Corrected Data</button>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="muted">Sample issues</div>
                  <ul>
                    <li>Missing Policy ID (9)</li>
                    <li>Invalid Date Format (6)</li>
                    <li>Claim TAT value out of range (12)</li>
                  </ul>
                  <button id="btn-proceed4" type="button">Proceed to Regulatory Checks</button>
                </div>
              </div>
            </div>
            <aside class="step-tasks" data-step="3">
              <h4>Tasks in this stage</h4>
              <ul class="task-list">
                <li><label><input type="checkbox" class="task-checkbox" data-step="3"> Run validation rules on all datasets</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="3"> Review failed records and error counts</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="3"> Send validation issues to insurer</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="3"> Finalize cleaned dataset for analysis</label></li>
              </ul>
            </aside>
          </div>
        </div>

        <!-- Step 4: Regulatory Check -->
        <div class="card" id="step-4" style="display:none; margin-top:var(--spacing-xl);">
          <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Regulatory Checklist & Automated Checks <span class="chip stage-chip" data-step="4" style="display:none;">Stage completed</span></h3>
          <div class="step-layout">
            <div class="step-main">
              <div class="row" style="margin-top:8px; align-items:center;">
                <div class="muted">Filter:</div>
                <button class="link" type="button" data-sev="All">All</button>
                <button class="link" type="button" data-sev="High">High</button>
                <button class="link" type="button" data-sev="Medium">Medium</button>
                <button class="link" type="button" data-sev="Low">Low</button>
              </div>
              <table style="margin-top:8px;">
                <thead><tr><th>Rule</th><th>Breach</th><th>Severity</th><th>Count</th></tr></thead>
                <tbody id="reg-table">
                  <tr data-sev="High"><td>Claims TAT &gt; SLA</td><td>Exceeded 30 days</td><td><span class="chip miss">High</span></td><td>12</td></tr>
                  <tr data-sev="High"><td>Repudiation cluster</td><td>Above baseline in region</td><td><span class="chip miss">High</span></td><td>6</td></tr>
                  <tr data-sev="Medium"><td>Grievance closure time</td><td>&gt; 15 days</td><td><span class="chip warn">Medium</span></td><td>9</td></tr>
                  <tr data-sev="Low"><td>Commission variance</td><td>&gt; 2σ of product</td><td><span class="chip info">Low</span></td><td>18</td></tr>
                </tbody>
              </table>
              <div style="margin-top:10px;">
                <button id="btn-proceed5" type="button">Proceed to Analytics & Sampling</button>
              </div>
            </div>
            <aside class="step-tasks" data-step="4">
              <h4>Tasks in this stage</h4>
              <ul class="task-list">
                <li><label><input type="checkbox" class="task-checkbox" data-step="4"> Run regulatory checklist rules</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="4"> Review HIGH severity breaches</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="4"> Tag breaches for observation drafting</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="4"> Park items needing more data or clarification</label></li>
              </ul>
            </aside>
          </div>
        </div>

        <!-- Step 5: Analytics & Sampling -->
        <div class="card" id="step-5" style="display:none; margin-top:var(--spacing-xl);">
          <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Analytics & Risk-Based Sampling <span class="chip stage-chip" data-step="5" style="display:none;">Stage completed</span></h3>
          <div class="step-layout">
            <div class="step-main">
              <div class="row" style="margin-top:8px;">
                <div class="col">
                  <div class="muted">Risk Scores</div>
                  <div style="margin-top:6px;">
                    <div class="row" style="align-items:center;"><div style="width:160px;">ICICI Lombard</div><div class="bar" style="flex:1;"><i style="width:85%"></i></div><div style="width:40px; text-align:right;">85</div></div>
                    <div class="row" style="align-items:center; margin-top:8px;"><div style="width:160px;">SBI Life</div><div class="bar" style="flex:1;"><i style="width:60%"></i></div><div style="width:40px; text-align:right;">60</div></div>
                    <div class="row" style="align-items:center; margin-top:8px;"><div style="width:160px;">LIC</div><div class="bar" style="flex:1;"><i style="width:40%"></i></div><div style="width:40px; text-align:right;">40</div></div>
                  </div>
                  <div class="card" style="margin-top:10px; padding:12px;">
                    <b>Insights</b>
                    <ul style="margin-top:6px;">
                      <li>Uptrend in claim repudiations in Q3</li>
                      <li>Anomaly: High refunds in branch #441</li>
                      <li>Early warning: Rising complaint rate in motor TP</li>
                    </ul>
                  </div>
                </div>
                <div class="col">
                  <div class="muted">Suggested Sample (editable)</div>
                  <table style="margin-top:6px;">
                    <thead><tr><th>Case ID</th><th>Reason</th><th></th></tr></thead>
                    <tbody id="sample-table">
                      <tr><td>CL-2115</td><td>High repudiation</td><td><button class="link del" type="button">Remove</button></td></tr>
                      <tr><td>CL-2100</td><td>Long TAT</td><td><button class="link del" type="button">Remove</button></td></tr>
                      <tr><td>CL-2091</td><td>Missing policy ID</td><td><button class="link del" type="button">Remove</button></td></tr>
                    </tbody>
                  </table>
                  <div class="row" style="margin-top:8px;">
                    <input id="add-id" placeholder="Add Case ID" style="flex:1;">
                    <button id="add-case" type="button">Add</button>
                  </div>
                </div>
              </div>
              <div class="card" style="margin-top:12px; padding:12px;">
                <h4 style="margin:0 0 6px 0;">Additional Documents / Clarification Requests</h4>
                <table>
                  <thead><tr><th>Case ID</th><th>Request</th><th>Status</th><th>Action</th></tr></thead>
                  <tbody id="clarify-table">
                    <tr><td>CL-2100</td><td>Discharge summary & hospital bill copy</td><td><span class="chip warn">Pending</span></td><td><button class="link mark-rec" type="button">Mark Received</button></td></tr>
                    <tr><td>CL-2115</td><td>Underwriting notes & agent memo</td><td><span class="chip warn">Pending</span></td><td><button class="link mark-rec" type="button">Mark Received</button></td></tr>
                  </tbody>
                </table>
                <div class="row" style="margin-top:8px;">
                  <input id="clarify-id" placeholder="Case ID">
                  <input id="clarify-text" placeholder="Request details" style="flex:1;">
                  <button id="clarify-add" type="button">Add Request</button>
                </div>
              </div>
              <div class="row" style="margin-top:10px;">
                <button id="finalize-sample" type="button" class="secondary">Finalize Sample (for Onsite)</button>
              </div>
            </div>
            <aside class="step-tasks" data-step="5">
              <h4>Tasks in this stage</h4>
              <ul class="task-list">
                <li><label><input type="checkbox" class="task-checkbox" data-step="5"> Review analytics results and risk scores</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="5"> Adjust sampling logic if required</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="5"> Generate recommended sample list</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="5"> Finalize sample set for onsite inspection</label></li>
              </ul>
            </aside>
          </div>
        </div>

        <!-- Step 6: Onsite -->
        <div class="card" id="step-6" style="display:none; margin-top:var(--spacing-xl);">
          <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Onsite Inspection Support <span class="chip stage-chip" data-step="6" style="display:none;">Stage completed</span></h3>
          <div class="step-layout">
            <div class="step-main">
              <div class="row" style="margin-top:8px;">
                <div class="col">
                  <div class="muted">Case Files</div>
                  <table style="margin-top:6px;">
                    <thead><tr><th>Case ID</th><th>Open</th></tr></thead>
                    <tbody id="onsite-cases">
                      <tr><td>CL-2100</td><td><button class="link" type="button">Open file</button></td></tr>
                      <tr><td>CL-2115</td><td><button class="link" type="button">Open file</button></td></tr>
                      <tr><td>CL-2091</td><td><button class="link" type="button">Open file</button></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col">
                  <div class="muted">Notes / Evidence</div>
                  <textarea id="onsite-notes" placeholder="Record interviews, walkthroughs, findings..." style="width:100%; height:120px; margin-top:6px;"></textarea>
                  <div class="row" style="margin-top:6px; align-items:center;">
                    <input type="file" id="onsite-file">
                    <button id="flag-risk" type="button">Flag High-Risk Issue</button>
                  </div>
                </div>
              </div>
              <div class="row" style="margin-top:10px;">
                <button id="btn-proceed7" type="button">Proceed to Observations</button>
              </div>
            </div>
            <aside class="step-tasks" data-step="6">
              <h4>Tasks in this stage</h4>
              <ul class="task-list">
                <li><label><input type="checkbox" class="task-checkbox" data-step="6"> Download final sample file for fieldwork</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="6"> Capture onsite notes / interviews in the portal</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="6"> Upload evidence (documents / screenshots)</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="6"> Flag high-risk issues found onsite</label></li>
              </ul>
            </aside>
          </div>
        </div>

        <!-- Step 7 -->
        <div class="card" id="step-7" style="display:none; margin-top:var(--spacing-xl);">
          <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Observation & Finding Management <span class="chip stage-chip" data-step="7" style="display:none;">Stage completed</span></h3>
          <div class="step-layout">
            <div class="step-main">
              <table>
                <thead><tr><th>Observation</th><th>Severity</th><th>Evidence Count</th><th>Status</th></tr></thead>
                <tbody id="obs-table">
                  <tr><td>Delayed claim TAT beyond SLA in 12 cases</td><td><span class="chip miss">High</span></td><td>3</td><td>Draft</td></tr>
                  <tr><td>Missing policy IDs in claims</td><td><span class="chip warn">Medium</span></td><td>2</td><td>Draft</td></tr>
                </tbody>
              </table>
              <div class="row" style="margin-top:8px;">
                <input id="obs-text" placeholder="Issue, rule breached, evidence, impact..." style="flex:2;">
                <select id="obs-sev"><option>High</option><option>Medium</option><option>Low</option></select>
                <button id="add-obs" type="button">Add Observation</button>
              </div>
              <div class="card" style="margin-top:12px; padding:12px;">
                <h4 style="margin:0 0 6px 0;">Inspection Report</h4>
                <div class="row">
                  <div class="col">
                    <label>Executive Summary</label>
                    <textarea id="exec" style="width:100%; height:120px; margin-top:6px;">Draft executive summary...</textarea>
                  </div>
                  <div class="col">
                    <label>Recommendations</label>
                    <textarea id="reco" style="width:100%; height:120px; margin-top:6px;">Key recommendations...</textarea>
                  </div>
                </div>
                <div class="row" style="margin-top:8px;">
                  <button id="btn-generate" type="button">Generate Report (PDF)</button>
                  <button id="btn-download" type="button">Export Word</button>
                </div>
              </div>
            </div>
            <aside class="step-tasks" data-step="7">
              <h4>Tasks in this stage</h4>
              <ul class="task-list">
                <li><label><input type="checkbox" class="task-checkbox" data-step="7"> Draft observations for key issues</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="7"> Attach evidence to each observation</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="7"> Review & refine observations</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="7"> Generate draft inspection report</label></li>
                <li><label><input type="checkbox" class="task-checkbox" data-step="7"> Mark report ready for management review</label></li>
              </ul>
            </aside>
          </div>
        </div>

      </div>
    </div>

    <!-- footer: single copy for all tabs (keeps visual style and appears on every view) -->
   </div> <!-- end regulator-view -->

    <!-- Insurer view (hidden by default) -->
    <div id="insurer-view" style="display:none;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title" style="color:var(--color-primary);">Insurer Workspace</h3>
          <div class="muted">Role: Insurer (demo)</div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid">
          <div class="card kpi-card">
            <div class="kpi-title">Datasets pending submission</div>
            <div id="kpi-pending" class="kpi-value">3</div>
          </div>
          <div class="card kpi-card">
            <div class="kpi-title">Validation issues to resolve</div>
            <div id="kpi-validation" class="kpi-value">27</div>
          </div>
          <div class="card kpi-card">
            <div class="kpi-title">Clarification requests pending</div>
            <div id="kpi-clarify" class="kpi-value">2</div>
          </div>
          <div class="card kpi-card">
            <div class="kpi-title">Upcoming deadlines</div>
            <div id="kpi-deadlines" class="kpi-value">2</div>
          </div>
        </div>

        <div class="flex-row">
          <div style="flex:1;">
            <!-- Messages from Regulator -->
            <div class="card" style="margin-top:var(--spacing-xl);">
              <h4 style="margin:0 0 var(--spacing-md) 0; color:var(--color-primary);">Messages from Regulator</h4>
              <div class="muted">Recent communications</div>
              <ul id="insurer-messages" style="margin-top:var(--spacing-md); padding-left:1.25rem;">
                <li>No messages.</li>
              </ul>
            </div>

            <!-- Insurer inspections list -->
            <div class="card" style="margin-top:var(--spacing-xl);">
              <h4 style="margin:0 0 var(--spacing-md) 0; color:var(--color-primary);">Your Inspections</h4>
              <table style="width:100%;">
                <thead><tr><th>ID</th><th>Period</th><th>Status</th><th>Deadline</th></tr></thead>
                <tbody id="insurer-inspections-body">
                  <tr data-inspection="INSP-1101"><td>INSP-1101</td><td>2025-Q3</td><td>Data Fetch</td><td>2025-11-25</td></tr>
                  <tr data-inspection="INSP-0999"><td>INSP-0999</td><td>2024-Q4</td><td>Closed</td><td>—</td></tr>
                </tbody>
              </table>
            </div>

            <!-- Upload / template actions -->
            <div class="card" style="margin-top:var(--spacing-xl);">
              <h4 style="margin:0 0 var(--spacing-md) 0; color:var(--color-primary);">DSF Template / Upload</h4>
              <div style="display:flex; gap:8px; align-items:center;">
                <button id="insurer-download-dsf" class="link" type="button">Download DSF Template</button>
              </div>
              <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
                <input id="insurer-upload-file" type="file" style="flex:1;">
                <button id="insurer-upload-btn" type="button">Upload</button>
              </div>
              <div style="margin-top:8px;">Status: <span id="insurer-validation-status">Not submitted</span></div>
            </div>

            <!-- Final report (visible only when inspection completed) -->
            <div id="insurer-final-report" class="card" style="display:none; margin-top:12px; text-align:center;">
              <h4 style="margin:0 0 8px 0;">Final Report</h4>
              <div class="muted">Inspection completed</div>
              <div style="margin-top:8px;">
                <button id="insurer-download-report" class="btn">Download Report</button>
              </div>
            </div>
          </div>

          <!-- RIGHT SIDE: Insurer Details Panel with Tabs -->
          <aside style="flex:1; min-width:500px;">
            <div class="card" style="margin-top:var(--spacing-xl);">
              <h4 style="margin:0 0 var(--spacing-lg) 0; color:var(--color-primary);">Insurer Details Panel</h4>
              
              <!-- Tabs -->
              <div class="insurer-tabs">
                <div class="insurer-tab active" data-insurer-tab="dsf">DSF Status</div>
                <div class="insurer-tab" data-insurer-tab="validation">Validation Issues</div>
                <div class="insurer-tab" data-insurer-tab="clarifications">Clarification Requests</div>
              </div>

              <!-- Tab Content -->
              <div id="insurer-tab-container">
                <!-- DSF Status Panel -->
                <div class="insurer-tab-panel active" data-panel="dsf">
                  <div style="overflow-x:auto;">
                  <table id="insurer-dsf-table" style="min-width:100%;">
                    <thead><tr><th>Dataset</th><th>Period</th><th>Template</th><th>Status</th><th>Action</th></tr></thead>
                    <tbody>
                      <!-- populated by JS from step-2 ds-status -->
                    </tbody>
                  </table>
                  </div>
                </div>

                <!-- Validation Issues Panel -->
                <div class="insurer-tab-panel" data-panel="validation">
                  <div style="overflow-x:auto;">
                  <table id="insurer-val-issues" style="min-width:100%;">
                    <thead><tr><th>Issue</th><th>Count</th><th>Severity</th><th>File</th><th>Status</th><th>Action</th></tr></thead>
                    <tbody>
                      <!-- populated by JS (reads step-3 summary / exceptions) -->
                    </tbody>
                  </table>
                  </div>
                </div>

                <!-- Clarification Requests Panel -->
                <div class="insurer-tab-panel" data-panel="clarifications">
                  <div style="overflow-x:auto;">
                  <table id="insurer-clar-requests" style="min-width:100%;">
                    <thead><tr><th>Case ID</th><th>Request</th><th>Status</th><th>Action</th></tr></thead>
                    <tbody>
                      <!-- populated by JS from #clarify-table -->
                    </tbody>
                  </table>
                  </div>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>
  </section>
  
  <!-- ====================== CONFIGURATION DASHBOARD ====================== -->
<section id="config-root" class="app-shell" style="display:none;">
  <div class="card" style="margin-bottom:var(--spacing-xl);">
    <h2 style="margin:0; color:var(--color-primary);">System Configuration Dashboard</h2>
    <div class="muted" style="margin-top:var(--spacing-sm);">Define rules, thresholds, weights, and templates that power Prototype</div>
  </div>
  <!-- Back to Dashboard button removed as requested -->

  <div class="tabs">
    <div class="tab active" data-target="data-validation">Data Validation Rules</div>
    <div class="tab" data-target="reg-rules">Regulatory Check</div>
    <div class="tab" data-target="analytics">Analytics</div>
    <div class="tab" data-target="risk-matrix">Risk Metrics</div>
    <div class="tab" data-target="early-warning">Early Warning Indicators</div>
    <div class="tab" data-target="insp-templates">Inspection Templates</div>
    <div class="tab" data-target="integrations">Integrations</div>
  </div>

  <section id="reg-rules" class="card">
    <div class="row" style="justify-content:space-between; align-items:center;">
      <h3 style="margin:0; color:var(--color-primary);">Configure Regulatory Checks</h3>
      <label class="switch"><input id="reg-enable" type="checkbox" checked><span class="slider"></span></label>
    </div>
    <div class="muted">Define rules applied during Regulatory Checks (Step 4).</div>
    <table style="width:100%; border-collapse:collapse; margin-top:8px;">
      <thead><tr><th>Rule Name</th><th>Condition</th><th>Severity</th><th>Status</th><th>Action</th></tr></thead>
      <tbody id="reg-body">
        <tr>
          <td>Claims TAT ≤ 30 days</td>
          <td>avg(claim_settlement_days) &gt; 30</td>
          <td><span class="chip miss">High</span></td>
          <td><span class="chip ok">Active</span></td>
          <td><button class="btn" type="button" style="background:#fff;color:#0f172a;">Edit</button></td>
        </tr>
      </tbody>
    </table>
    <div class="row" style="margin-top:10px;">
      <div class="col"><input id="reg-name" placeholder="Rule name (e.g., Claims TAT ≤ 30 days)"></div>
      <div class="col"><input id="reg-cond" placeholder="Condition (e.g., avg(claim_settlement_days) > 30)"></div>
      <div class="col"><select id="reg-sev"><option>High</option><option>Medium</option><option>Low</option></select></div>
      <div class="col" style="max-width:160px;"><button id="reg-add" type="button" class="btn">Add Rule</button></div>
    </div>
  </section>

  <section id="analytics" class="card" style="margin-top:var(--spacing-xl); display:none;">
    <div class="row" style="justify-content:space-between; align-items:center;">
      <h3 style="margin:0; color:var(--color-primary);">Configure Analytics Models</h3>
      <label class="switch"><input id="ana-enable" type="checkbox" checked><span class="slider"></span></label>
    </div>
    <div class="muted">Select algorithms and set sensitivity/thresholds.</div>
    <table style="width:100%; border-collapse:collapse; margin-top:8px;">
      <thead><tr><th>Model Name</th><th>Type</th><th>Dataset</th><th>Sensitivity</th><th>Status</th><th>Action</th></tr></thead>
      <tbody id="ana-body">
        <tr><td>Repudiation Outlier</td><td>Z-score</td><td>Claims</td><td>0.85</td><td><span class="chip ok">Active</span></td><td><button class="btn" type="button" style="background:#fff;color:#0f172a;">Edit</button></td></tr>
      </tbody>
    </table>
    <div class="row" style="margin-top:10px;">
      <div class="col"><input id="ana-name" placeholder="Model name"></div>
      <div class="col"><select id="ana-type"><option>Z-score</option><option>IQR</option><option>Clustering (K-Means)</option><option>Regression</option><option>Time-series</option></select></div>
      <div class="col"><select id="ana-data"><option>Claims</option><option>Underwriting</option><option>Grievances</option><option>Sales/Agents</option></select></div>
      <div class="col"><input id="ana-sens" placeholder="Sensitivity (0-1)" value="0.75"></div>
      <div class="col" style="max-width:160px;"><button id="ana-add" type="button" class="btn">Add Model</button></div>
    </div>
  </section>

  <section id="risk-matrix" class="card" style="margin-top:var(--spacing-xl); display:none;">
    <div class="row" style="justify-content:space-between; align-items:center;">
      <h3 style="margin:0; color:var(--color-primary);">Configure Risk Scoring Matrix</h3>
      <label class="switch"><input id="risk-enable" type="checkbox" checked><span class="slider"></span></label>
    </div>
    <div class="muted">Define weights and cutoffs used for composite insurer risk scores.</div>
    <div class="row" style="margin-top:10px;">
      <div class="col"><label>Grievances Weight (%)</label><input id="w-griev" value="30"></div>
      <div class="col"><label>Regulatory Breaches Weight (%)</label><input id="w-breach" value="35"></div>
      <div class="col"><label>Data Quality Weight (%)</label><input id="w-quality" value="15"></div>
      <div class="col"><label>Persistency / Claims Ratios (%)</label><input id="w-metrics" value="20"></div>
    </div>
    <div class="row" style="margin-top:10px;">
      <div class="col"><label>High-Risk Cutoff</label><input id="risk-cutoff" value="80"></div>
      <div class="col" style="max-width:180px; align-self:end;"><button id="risk-save" type="button" class="btn">Save Weights</button></div>
    </div>
    <div id="risk-msg" class="muted" style="margin-top:8px;"></div>
  </section>

  <section id="data-validation" class="card" style="margin-top:var(--spacing-xl); display:none;">
    <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Data Validation Rules</h3>
    <div class="muted">Create and maintain structural and business rule checks for incoming datasets.</div>
    <div class="row" style="margin-top:10px;">
      <div class="col"><input placeholder="Rule name (e.g., Policy ID not null)"></div>
      <div class="col"><input placeholder="Expression (e.g., not isnull(policy_id))"></div>
      <div class="col"><select><option>High</option><option>Medium</option><option>Low</option></select></div>
      <div class="col" style="max-width:160px;"><button class="btn" type="button">Add Rule</button></div>
    </div>
  </section>

  <section id="early-warning" class="card" style="margin-top:var(--spacing-xl); display:none;">
    <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Early Warning Indicators</h3>
    <div class="muted">Configure grievance trends, anomaly thresholds, and triggers for automated alerts.</div>
    <div class="row" style="margin-top:10px;">
      <div class="col"><label>Complaint spike threshold (%)</label><input value="25"></div>
      <div class="col"><label>Repudiation rate z-score</label><input value="2.0"></div>
      <div class="col"><label>Refunds volume anomaly</label><input value="3σ"></div>
    </div>
  </section>

  <section id="dash-kpis" class="card" style="margin-top:18px; display:none;">
    <h3>Dashboard & KPIs</h3>
    <div class="muted">Choose KPI cards and layouts for the supervisory dashboard.</div>
    <div class="row" style="margin-top:10px;">
      <label><input type="checkbox" checked> Active Inspections</label>
      <label><input type="checkbox" checked> Pending Fetches</label>
      <label><input type="checkbox" checked> High-risk Alerts</label>
    </div>
  </section>

  <section id="insp-templates" class="card" style="margin-top:var(--spacing-xl); display:none;">
    <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Inspection Templates</h3>
    <div class="muted">Manage document templates for DSF, exception reports, and final reports.</div>
    <div class="row" style="margin-top:10px;">
      <div class="col"><input placeholder="Template name (e.g., DSF Claims 2025)"></div>
      <div class="col" style="max-width:160px;"><button class="btn" type="button">Upload</button></div>
    </div>
  </section>

  <section id="notifications" class="card" style="margin-top:18px; display:none;">
    <h3>Notifications</h3>
    <div class="muted">Define email/SMS alerts for events like data receipt, validation failures, and high-risk flags.</div>
    <div class="row" style="margin-top:10px;">
      <label><input type="checkbox" checked> Data receipt summary</label>
      <label><input type="checkbox" checked> Validation failure</label>
      <label><input type="checkbox"> High-risk alert</label>
    </div>
  </section>

  <section id="user-roles" class="card" style="margin-top:18px; display:none;">
    <h3>User Roles</h3>
    <div class="muted">Manage access roles (Inspector, Admin, Viewer) and permissions.</div>
    <table style="margin-top:8px;">
      <thead><tr><th>Role</th><th>Permissions</th><th>Action</th></tr></thead>
      <tbody>
        <tr><td>Inspector</td><td>Create, Validate, Onsite, Observations</td><td><button class="btn" type="button" style="background:#fff;color:#0f172a;">Edit</button></td></tr>
        <tr><td>Admin</td><td>All modules + Configuration</td><td><button class="btn" type="button" style="background:#fff;color:#0f172a;">Edit</button></td></tr>
      </tbody>
    </table>
  </section>

  <section id="integrations" class="card" style="margin-top:var(--spacing-xl); display:none;">
    <h3 style="color:var(--color-primary); margin-bottom:var(--spacing-md);">Integrations</h3>
    <div class="muted">Connect external systems and view connection status.</div>
    <div style="margin-top:12px;">
      <div class="row" style="align-items:center; margin-bottom:10px;">
        <div style="flex:1; font-weight:700;">Bima Bharosa</div>
        <div style="flex:0 0 420px;"><input placeholder="Endpoint URL" style="width:100%;"></div>
        <div style="flex:0 0 120px; text-align:right;"><span class="chip ok">Integrated</span></div>
      </div>

      <div class="row" style="align-items:center; margin-bottom:10px;">
        <div style="flex:1; font-weight:700;">IIB</div>
        <div style="flex:0 0 420px;"><input placeholder="Endpoint / API Key" style="width:100%;"></div>
        <div style="flex:0 0 120px; text-align:right;"><span class="chip miss">Not connected</span></div>
      </div>

      <div class="row" style="align-items:center;">
        <div style="flex:1; font-weight:700;">Other Links</div>
        <div style="flex:0 0 420px;"><input placeholder="Add URL or notes" style="width:100%;"></div>
        <div style="flex:0 0 120px; text-align:right;"><span class="chip warn">Partial</span></div>
      </div>
    </div>
  </section>
</section>
<!-- config sections end -->

<!-- global footer (moved to page end so it does not sit between KPI cards and config) -->
<div class="footer">Prototype - Developed by InsurTech Team</div>

<!-- Dummy final-report modal -->
<div id="report-modal" class="modal" aria-hidden="true">
  <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="report-title">
    <header>
      <h3 id="report-title" style="margin:0;">Final Inspection Report</h3>
      <div><button class="close" id="report-close" aria-label="Close">✕</button></div>
    </header>
    <div class="content" id="report-content">
      <!-- dummy content -->
      <h4 style="margin-top:0;">Report preview (dummy)</h4>
      <p>This is a placeholder for the final inspection report. When integrated, the PDF or report viewer will render here.</p>
      <p><b>Report ID:</b> <span id="report-id">—</span></p>
      <hr/>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse potenti. Nulla facilisi. (Dummy preview)</p>
    </div>
    <div style="margin-top:12px; text-align:right;">
      <button id="report-download" class="btn">Download (dummy)</button>
      <button id="report-close-2" class="btn small" style="background:#0f172a; margin-left:8px;">Close</button>
    </div>
  </div>
</div>

<!-- Communication modal (for ongoing -> message insurer) -->
<div id="comm-modal" class="modal" aria-hidden="true" style="display:none;">
  <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="comm-title">
    <header>
      <h3 id="comm-title" style="margin:0;">Communication — <span id="comm-ins-id">—</span></h3>
      <div><button class="close" id="comm-close" aria-label="Close">✕</button></div>
    </header>
    <div class="content" id="comm-content" style="display:flex; flex-direction:column; gap:12px;">
      <div id="comm-thread" style="flex:1; overflow:auto; padding:8px; border:1px solid var(--color-border); border-radius:6px; background:white;">
        <div class="muted">Conversation will appear here (dummy).</div>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <input id="comm-input" placeholder="Type a message to insurer..." style="flex:1; padding:0.6rem; border-radius:6px; border:1.5px solid var(--color-border);">
        <button id="comm-send" class="btn">Send</button>
        <button id="comm-close-2" class="btn small" style="background:#0f172a; color:white;">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // Simple helpers
  const $  = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

  const login   = $('#login');
  const appRoot = $('#app-root');
  const config  = $('#config-root');

  // Login toggle
  $('#login-btn')?.addEventListener('click', ()=>{
    const email = $('#email')?.value.trim();
    const password = $('#password')?.value.trim();
    
    // Validate credentials
    if(email !== 'pilot' || password !== 'insurance'){
      alert('Please enter valid credentials');
      return;
    }
    
    if(login) login.style.display = 'none';
    if(appRoot){ appRoot.style.display = ''; window.scrollTo({top:0, behavior:'smooth'}); }
    showOnly('home');
  });

  // Logout handler
  $('#logout-btn')?.addEventListener('click', ()=>{
    if(appRoot) appRoot.style.display = 'none';
    if(config) config.style.display = 'none';
    if(login) login.style.display = 'block';

    // Clear form fields
    const emailInput = $('#email');
    const passwordInput = $('#password');
    if(emailInput) emailInput.value = '';
    if(passwordInput) passwordInput.value = '';
    // Scroll to top and reload
    window.scrollTo({top:0, behavior:'smooth'});
    setTimeout(()=>{ location.reload(); }, 300);
  });

  // Template vs Manual toggle: show/hide sections
  (function(){
    const tplRadio   = document.getElementById('mode-template');
    const manualRadio= document.getElementById('mode-manual');
    const tplSection = document.getElementById('templateSection');
    const manualSection = document.getElementById('manualSection');

    function setModeTemplate(isTemplate){
      if(tplSection) tplSection.style.display = isTemplate ? '' : 'none';
      if(manualSection) manualSection.style.display = isTemplate ? 'none' : '';
    }

    // wire radios
    tplRadio?.addEventListener('change', ()=> setModeTemplate(true));
    manualRadio?.addEventListener('change', ()=> setModeTemplate(false));

    // initialize (default = template)
    setModeTemplate(true);
  })();

  // Show default list
  function showList(kind){
    const lists = $('#lists');
    const flow  = $('#flow');
    if(lists) lists.style.display = 'grid';
    if(flow)  flow.style.display  = 'none';

    const SAMPLE = {
      ongoing: [
        {id:'INSP-1101', insurer:'ICICI Lombard', period:'2025-07-01 → 2025-09-30', status:'Data Fetch', owner:'A. Kumar'},
        {id:'INSP-1102', insurer:'SBI Life',       period:'2025-06-01 → 2025-06-30', status:'Validation', owner:'R. Singh'},
        {id:'INSP-1103', insurer:'LIC',            period:'2025-05-01 → 2025-05-31', status:'Regulatory', owner:'P. Rao'},
        {id:'INSP-1104', insurer:'HDFC Ergo',      period:'2025-04-01 → 2025-04-30', status:'Analytics', owner:'M. Iyer'},
        {id:'INSP-1105', insurer:'Bajaj Allianz',  period:'2025-03-01 → 2025-03-31', status:'Onsite', owner:'S. Iyer'},
        {id:'INSP-1106', insurer:'Tata AIG',       period:'2025-02-01 → 2025-02-28', status:'Observations', owner:'P. Rao'}
      ],
      completed: [
        {id:'INSP-0999', insurer:'HDFC Ergo', period:'2024-10-01 → 2024-12-31', status:'Closed', owner:'A. Kumar'},
        {id:'INSP-0992', insurer:'LIC',       period:'2024-07-01 → 2024-09-30', status:'Closed', owner:'M. Iyer'}
      ]
    };

    // update table header according to list kind
    const headEl = $('#lists thead');
    if(headEl){
      const headHtml = (kind === 'ongoing')
        ? `<tr><th>ID</th><th>Insurer</th><th>Period</th><th>Status</th><th>Owner</th><th>Communication</th></tr>`
        : `<tr><th>ID</th><th>Insurer</th><th>Period</th><th>Status</th><th>Owner</th><th>Final Report</th></tr>`;
      headEl.innerHTML = headHtml;
    }

    const rows = (SAMPLE[kind]||[]).map(r => {
      if(kind === 'completed'){
        const reportBtn = `<button class="btn small view-report" data-id="${r.id}" title="View final report">View</button>`;
        return `<tr>
                  <td>${r.id}</td>
                  <td>${r.insurer}</td>
                  <td>${r.period}</td>
                  <td><span class="${r.status==='Closed'?'chip ok':'chip info'}">${r.status}</span></td>
                  <td>${r.owner}</td>
                  <td style="width:140px; text-align:right;">${reportBtn}</td>
                </tr>`;
      } else {
        const commBtn = `<button class="btn small comm-btn" data-id="${r.id}" title="Message insurer">Message</button>`;
        return `<tr>
                  <td>${r.id}</td>
                  <td>${r.insurer}</td>
                  <td>${r.period}</td>
                  <td><span class="${r.status==='Closed'?'chip ok':'chip info'}">${r.status}</span></td>
                  <td>${r.owner}</td>
                  <td style="width:140px; text-align:right;">${commBtn}</td>
                </tr>`;
      }
    }).join('');

    const body  = $('#list-body'); if(body) body.innerHTML = rows;
    const title = $('#list-title'); if(title) title.textContent = (kind==='ongoing')?'Ongoing Inspections':'Completed Inspections';
  }
  //showList('completed');  // don't show completed by default

  // Go to a specific step section and show flow
  function gotoStep(n){
    const lists = $('#lists');
    const flow  = $('#flow');
    if(lists) lists.style.display = 'none';
    if(flow)  flow.style.display  = 'block';
    // toggle active chip + panels
    $$('.step').forEach(s => s.classList.toggle('active', s.dataset.step == String(n)));
    for(let i=1;i<=7;i++){
      const area = $('#step-'+i);
      if(area) area.style.display = (i===n)?'block':'none';
    }
    flow?.scrollIntoView({behavior:'smooth', block:'start'});
  }
  window.gotoStep = gotoStep;

  // Toolbar actions
  // === Config Tabs behavior ===
  function initConfigTabs(){
    const root = document.getElementById('config-root');
    if(!root) return;
    const tabs = root.querySelectorAll('.tab');
    // new ordered list of sections (matches the reduced tabs)
    const sectionIds = ['data-validation','reg-rules','analytics','risk-matrix','early-warning','insp-templates','integrations'];
    const sections = sectionIds.map(id => document.getElementById(id)).filter(Boolean);
    function activate(target){
      tabs.forEach(t => t.classList.toggle('active', t.getAttribute('data-target')===target));
      sections.forEach(sec => { sec.style.display = (sec.id === target) ? 'block' : 'none'; });
    }
    tabs.forEach(t => t.addEventListener('click', ()=> activate(t.getAttribute('data-target'))));
    const first = tabs[0];
    const defaultTarget = (root.querySelector('.tab.active') || first)?.getAttribute('data-target') || 'reg-rules';
    activate(defaultTarget);
  }

  function showOnly(section){
    const lists = $('#lists');
    const flow  = $('#flow');
    const home = $('#home');
    const supToolbar = $('#supervision-toolbar');
    const homeBtn = $('#btn-home');
    
    // hide everything by default, then show the requested section
    if(lists) lists.style.display='none';
    if(flow)  flow.style.display='none';
    if(config) config.style.display='none';
    if(home) home.style.display='none';

    // Update Home button active state
    if(homeBtn) {
      if(section === 'home') {
        homeBtn.classList.add('active');
      } else {
        homeBtn.classList.remove('active');
      }
    }

    if(section === 'home'){ 
      if(home) home.style.display='block'; 
      if(supToolbar) supToolbar.style.display='none'; // Hide toolbar on home
    }
    if(section === 'flow'){ 
      if(flow) flow.style.display='block'; 
      if(supToolbar) supToolbar.style.display='flex'; // Show toolbar in inspection flow
    }
    if(section === 'ongoing'){ 
      if(lists) { lists.style.display='block'; showList('ongoing'); } 
      if(supToolbar) supToolbar.style.display='flex'; // Show toolbar
    }
    if(section === 'completed'){ 
      if(lists) { lists.style.display='block'; showList('completed'); } 
      if(supToolbar) supToolbar.style.display='flex'; // Show toolbar
    }
    if(section === 'config'){ 
      if(config){ config.style.display=''; config.scrollIntoView({behavior:'smooth', block:'start'}); } 
      if(supToolbar) supToolbar.style.display='flex'; // Show toolbar
    }
  }
  $('#btn-home')?.addEventListener('click', ()=> {
    showOnly('home');
    // ensure the home tabs reset to the default (first) tab (Risk Based Supervision)
    const firstTab = document.querySelector('#home .tabs .tab');
    if(firstTab) firstTab.click();
    // scroll to top of app for good measure
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  $('#btn-start')?.addEventListener('click', ()=> { showOnly('flow'); gotoStep(1); });
  $('#btn-view-ongoing')?.addEventListener('click', ()=> showOnly('ongoing'));
  $('#btn-view-completed')?.addEventListener('click', ()=> showOnly('completed'));
  $('#btn-config')?.addEventListener('click', ()=> { showOnly('config'); initConfigTabs(); });

  // Home tabs behavior: switch panels inside #home
  (function(){
    const homeRoot = document.getElementById('home');
    if(!homeRoot) return;
    const tabs = Array.from(homeRoot.querySelectorAll('.tabs .tab'));
    const panels = ['rbs','supervision','enforcement','grievance'];

    // show the selected home panel; when `collapse` is true hide other main tabs (show only active)
    function activateHome(target, collapse=false){
      // mark active tab
      tabs.forEach(t => t.classList.toggle('active', t.getAttribute('data-home')===target));
      // show only the selected panel
      panels.forEach(p => {
        const el = document.getElementById('home-' + p);
        if(el) el.style.display = (p === target) ? 'block' : 'none';
      });
      // supervision-specific sub-toolbar
      const supToolbar = document.getElementById('supervision-toolbar');
      if(supToolbar) supToolbar.style.display = (target === 'supervision') ? 'flex' : 'none';

      // collapse other main tabs when requested (keeps only the active main tab visible)
      tabs.forEach(t => {
        if(collapse){
          t.style.display = (t.getAttribute('data-home')===target) ? 'inline-flex' : 'none';
        } else {
          t.style.display = ''; // restore default / original display
        }
      });
    }

    // wire up clicks
    tabs.forEach(t => t.addEventListener('click', (ev) => activateHome(t.getAttribute('data-home'), !!ev.isTrusted)));

    // ensure initial panel visible but do NOT collapse other tabs on initial load/programmatic click
    const active = tabs.find(t => t.classList.contains('active')) || tabs[0];
    if(active) activateHome(active.getAttribute('data-home'), false);
  })();

 // Step nav clicks
 
   $$('.step').forEach(s => s.addEventListener('click', ()=> gotoStep(parseInt(s.dataset.step))));
 
  // Team pills
  function renderPills(){
     const sel = $$('.team').filter(b => b.checked).map(b => b.value);
     const pills = $('#team-pills');
     if(pills) pills.innerHTML = sel.map(m => `<span class="pill"><b>${m}</b></span>`).join('');
   }
   $$('.team').forEach(b => b.addEventListener('change', renderPills));
   renderPills();

  // Show only field dropdowns for categories selected in the multi-select (#data-cats)
  (function(){
    const dataCats = document.getElementById('data-cats');
    const cats = ['claims','under','griev','sales'];
    function updateVisible(){
      const selected = dataCats ? Array.from(dataCats.selectedOptions).map(o=>o.value) : [];
      cats.forEach(cat => {
        const el = document.getElementById('fields-' + cat);
        if(!el) return;
        // show details only if category selected; otherwise hide
        el.style.display = selected.includes(cat) ? 'block' : 'none';
        // open the details panel when shown for convenience
        if(el.tagName === 'DETAILS') el.open = selected.includes(cat);
      });
    }
    if(dataCats){
      // initialize according to default selection (none selected by default)
      updateVisible();
      dataCats.addEventListener('change', updateVisible);
    }
  })();

  // Create inspection

  $('#create-inspection')?.addEventListener('click', ()=>{
    const insurer = $('#insurer')?.value;
    const from    = $('#from')?.value;
    const to      = $('#to')?.value;
    const chosen  = $$('.team').filter(b=>b.checked).map(b=>b.value);

    if(!insurer || !from || !to || chosen.length===0){
      alert('Fill insurer, dates, and team.');
      return;
    }
    const active = $('#kpi-active'); if(active) active.textContent = String((+active.textContent||0)+1);
    gotoStep(2);
  });

  // Fetch -> proceed
  $('#btn-fetch-all')?.addEventListener('click', ()=>{
    $$('#ds-status td:nth-child(2)').forEach(td=> td.innerHTML = '<span class="chip ok">✓ Fetched</span>');
    const ts = new Date().toLocaleString('en-GB',{hour:'2-digit',minute:'2-digit',day:'2-digit',month:'short',year:'numeric'});
    $$('#ds-status td:nth-child(3)').forEach(td=> td.textContent = ts);
    const cf = $('#chk-fields'); if(cf){ cf.className='chip ok'; cf.textContent='✓ All requested fields fetched'; }
    const cp = $('#chk-period'); if(cp){ cp.className='chip ok'; cp.textContent='✓ Requested time period fetched'; }
    const p3 = $('#btn-proceed3'); if(p3) p3.disabled=false;
  });
  $('#btn-proceed3')?.addEventListener('click', ()=> gotoStep(3));

  // Validation -> proceed
  $('#btn-exception')?.addEventListener('click', ()=>{
    const content = 'CaseID,Issue,Severity\nCL-2100,Invalid date,High\nCL-2115,Missing policy ID,Medium';
    const blob = new Blob([content], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'validation_exceptions.csv'; a.click();
    URL.revokeObjectURL(url);
  });
  $('#btn-req-fix')?.addEventListener('click', ()=> alert('Request for corrected data sent to insurer (simulated).'));
  $('#btn-proceed4')?.addEventListener('click', ()=> gotoStep(4));

  // Regulatory filter + proceed
  $$('#step-4 .link[data-sev]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const sev = btn.getAttribute('data-sev');
      $$('#reg-table tr').forEach(tr => tr.style.display = (sev==='All' || tr.getAttribute('data-sev')===sev)?'':'none');
    });
  });
  $('#btn-proceed5')?.addEventListener('click', ()=> gotoStep(5));

  // Sampling add/remove
  function attachDelHandlers(){
    $$('#sample-table .del').forEach(b => b.onclick = (e)=>{ e.target.closest('tr')?.remove(); });
  }
  attachDelHandlers();
  $('#add-case')?.addEventListener('click', ()=>{
    const id = $('#add-id')?.value.trim();
    if(!id) return;
    $('#sample-table')?.insertAdjacentHTML('beforeend', `<tr><td>${id}</td><td>Manual add</td><td><button class="link del" type="button">Remove</button></td></tr>`);
    const addId = $('#add-id'); if(addId) addId.value='';
    attachDelHandlers();
  });

  // Clarifications
  $('#clarify-table')?.addEventListener('click', (e)=>{
    if(e.target.classList.contains('mark-rec')){
      const td = e.target.closest('tr').children[2];
      td.innerHTML = '<span class="chip ok">✓ Received</span>';
    }
  });
  $('#clarify-add')?.addEventListener('click', ()=>{
    const id  = $('#clarify-id')?.value.trim();
    const txt = $('#clarify-text')?.value.trim();
    if(!id || !txt) return;
    $('#clarify-table')?.insertAdjacentHTML('beforeend', `<tr><td>${id}</td><td>${txt}</td><td><span class="chip warn">Pending</span></td><td><button class="link mark-rec" type="button">Mark Received</button></td></tr>`);
    const idEl  = $('#clarify-id');  if(idEl)  idEl.value='';
    const txtEl = $('#clarify-text'); if(txtEl) txtEl.value='';
  });

  // Finalize -> onsite
  $('#finalize-sample')?.addEventListener('click', ()=> gotoStep(6));

  // Onsite -> observations
  $('#flag-risk')?.addEventListener('click', ()=> alert('High-risk issue flagged (simulated).'));
  $('#btn-proceed7')?.addEventListener('click', ()=> gotoStep(7));

  // Observations interactions
  $('#add-obs')?.addEventListener('click', ()=>{
    const text = $('#obs-text')?.value.trim();
    const sev  = $('#obs-sev')?.value;
    if(!text) return;
    $('#obs-table')?.insertAdjacentHTML('beforeend', `<tr><td>${text}</td><td><span class="chip ${sev==='High'?'miss':sev==='Medium'?'warn':'info'}">${sev}</span></td><td>0</td><td>Draft</td></tr>`);
    const t = $('#obs-text'); if(t) t.value='';
  });
  $('#btn-generate')?.addEventListener('click', ()=> alert('PDF generated (simulated).'));
  $('#btn-download')?.addEventListener('click', ()=> alert('Word exported (simulated).'));

  // final report modal handlers
  const modal = document.getElementById('report-modal');
  const reportIdEl = document.getElementById('report-id');
  function openReport(id){
    if(reportIdEl) reportIdEl.textContent = id;
    if(modal){ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }
  }
  function closeReport(){
    if(modal){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }
  }
  // delegated click handler for view buttons (report) and comm buttons
  document.body.addEventListener('click', function(e){
    const t = e.target;
    if(!t) return;
    // final report open
    if(t.classList && t.classList.contains('view-report')){
      const id = t.getAttribute('data-id') || '—';
      const reportIdEl = document.getElementById('report-id');
      const modal = document.getElementById('report-modal');
      if(reportIdEl) reportIdEl.textContent = id;
      if(modal){ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }
      return;
    }
    // communication open
    if(t.classList && t.classList.contains('comm-btn')){
      const id = t.getAttribute('data-id') || '—';
      const commModal = document.getElementById('comm-modal');
      const commIdEl = document.getElementById('comm-ins-id');
      const commThread = document.getElementById('comm-thread');
      if(commIdEl) commIdEl.textContent = id;
      if(commThread) commThread.innerHTML = `<div class="muted">Conversation with ${id} (dummy)</div>
        <div style="margin-top:8px;"><b>Regulator:</b> Please provide missing dataset.</div>
        <div style="margin-top:6px;"><b>Insurer:</b> Will upload shortly.</div>`;
      if(commModal){ commModal.classList.add('show'); commModal.setAttribute('aria-hidden','false'); }
      document.getElementById('comm-input')?.focus();
      return;
    }
    // close buttons
    if(t.id === 'report-close' || t.id === 'report-close-2') {
      document.getElementById('report-modal')?.classList.remove('show');
      document.getElementById('report-modal')?.setAttribute('aria-hidden','true');
    }
    if(t.id === 'comm-close' || t.id === 'comm-close-2') {
      document.getElementById('comm-modal')?.classList.remove('show');
      document.getElementById('comm-modal')?.setAttribute('aria-hidden','true');
    }
    if(t.id === 'report-download') {
      const reportId = document.getElementById('report-id')?.textContent || '—';
      alert('Download (dummy) — report for ' + reportId);
    }
  });
  // send message handler (dummy)
  document.getElementById('comm-send')?.addEventListener('click', function(){
    const input = document.getElementById('comm-input');
    const thread = document.getElementById('comm-thread');
    const txt = input?.value?.trim();
    if(!txt) return;
    const div = document.createElement('div');
    div.style.marginTop = '8px';
    div.innerHTML = `<div style="text-align:right;"><b>You:</b> ${escapeHtml(txt)}</div>`;
    thread?.appendChild(div);
    thread.scrollTop = thread.scrollHeight;
    if(input) input.value = '';
    setTimeout(()=> {
      const r = document.createElement('div');
      r.style.marginTop = '6px';
      r.innerHTML = `<div><b>Insurer:</b> (auto reply) Received.</div>`;
      thread?.appendChild(r);
      thread.scrollTop = thread.scrollHeight;
    }, 600);
  });
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  // close modal when clicking on overlay
  document.getElementById('report-modal')?.addEventListener('click', function(e){ if(e.target === this) this.classList.remove('show'); });
  document.getElementById('comm-modal')?.addEventListener('click', function(e){ if(e.target === this) this.classList.remove('show'); });
  // --- Task checklist behaviour (added) ---
  (function(){
    function updateStepState(n){
      const boxes = Array.from(document.querySelectorAll('.task-checkbox[data-step="'+n+'"]'));
      if(boxes.length === 0) return;
      const all = boxes.every(b => b.checked);
      const chip = document.querySelector('.stage-chip[data-step="'+n+'"]');
      const navStep = document.querySelector('.steps .step[data-step="'+n+'"]');

      if(all){
        if(chip) chip.style.display = 'inline-block';
        if(navStep) navStep.classList.add('done');
      } else {
        if(chip) chip.style.display = 'none';
        if(navStep) navStep.classList.remove('done');
      }
    }
    // attach listeners
    document.querySelectorAll('.task-checkbox').forEach(cb => {
      cb.addEventListener('change', (e)=>{
        const n = e.target.getAttribute('data-step');
        updateStepState(n);
      });
    });
    // initialize existing state on load (in case some boxes are pre-checked)
    const steps = ['1','2','3','4','5','6','7'];
    steps.forEach(s => updateStepState(s));
  })();

  // Role switch: Regulator <-> Insurer
  (function(){
    const roleSwitch = document.getElementById('role-switch');
    const regulatorView = document.getElementById('regulator-view');
    const insurerView = document.getElementById('insurer-view');

    function setRole(role){
      if(role === 'insurer'){
        if(regulatorView) regulatorView.style.display = 'none';
        if(insurerView) insurerView.style.display = 'block';
        // hide configuration dashboard for insurer role
        if(config) config.style.display = 'none';
      } else {
        if(regulatorView) regulatorView.style.display = '';
        if(insurerView) insurerView.style.display = 'none';
        // show configuration dashboard for regulator role
        if(config) config.style.display = '';
      }
      // small scroll to top to position view
      window.scrollTo({top:0, behavior:'smooth'});
    }

    roleSwitch?.addEventListener('change', function(){
      setRole(this.value);
    });

    // inspector row click: update details panel
    document.getElementById('insurer-inspections-body')?.addEventListener('click', function(e){
      const tr = e.target.closest('tr[data-inspection]');
      if(!tr) return;
      const id = tr.getAttribute('data-inspection');
      const title = document.getElementById('insurer-work-title');
      const status = document.getElementById('insurer-validation-status');
      if(title) title.textContent = 'Inspection details — ' + id;
      if(status) status.textContent = tr.children[3]?.textContent || 'Data pending';
      // replace messages for demo
      const msgs = document.getElementById('insurer-messages');
      if(msgs){
        msgs.innerHTML = `<li>IRDAI request: Please upload dataset as per DSF.</li>
                          <li>Deadline: ${tr.children[4]?.textContent || '—'}</li>`;
      }
    });

    // demo DSF download (just a small CSV)
    document.getElementById('insurer-download-dsf')?.addEventListener('click', function(){
      const csv = 'case_id,policy_number,claim_date,amount\n';
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'dsf_template.csv'; a.click();
      URL.revokeObjectURL(url);
    });

    // demo upload behaviour: mark validation status as "Submitted" then "Under validation"
    document.getElementById('insurer-upload-btn')?.addEventListener('click', function(){
      const fileEl = document.getElementById('insurer-upload-file');
      const status = document.getElementById('insurer-validation-status');
      if(!fileEl || !fileEl.files || fileEl.files.length===0){ alert('Choose a file to upload'); return; }
      if(status) status.textContent = 'Submitted — awaiting validation';
      // simulate async validation result
      setTimeout(()=>{
        if(status) status.textContent = 'Under validation';
      }, 800);
    });

    // initialize default role
    setRole(roleSwitch?.value || 'regulator');
  })();

  // === Insurer View Tab Switching (insurer-specific only) ===
  (function(){
    // Only run if insurer view exists
    const insurerView = document.getElementById('insurer-view');
    if(!insurerView) return;

    const insurerTabs = insurerView.querySelectorAll('.insurer-tab');
    const insurerPanels = insurerView.querySelectorAll('.insurer-tab-panel');

    insurerTabs.forEach(tab => {
      tab.addEventListener('click', function(){
        const targetPanel = this.getAttribute('data-insurer-tab');
        
        // Remove active from all tabs and panels
        insurerTabs.forEach(t => t.classList.remove('active'));
        insurerPanels.forEach(p => p.classList.remove('active'));
        
        // Add active to clicked tab
        this.classList.add('active');
        
        // Show corresponding panel
        const panel = insurerView.querySelector(`.insurer-tab-panel[data-panel="${targetPanel}"]`);
        if(panel) panel.classList.add('active');
      });
    });
  })();
  
  // === Step 1: Automatic task status indicators ===
  (function(){
    let step1Created = false;

    // Get form elements
    const insurerSelect = document.getElementById('insurer');
    const fromInput = document.getElementById('from');
    const toInput = document.getElementById('to');
    const templateSelect = document.getElementById('template-select');
    const dataCatsSelect = document.getElementById('data-cats');
    const modeTemplate = document.getElementById('mode-template');
    const modeManual = document.getElementById('mode-manual');
    const teamCheckboxes = document.querySelectorAll('.team');
    const createBtn = document.getElementById('create-inspection');
    const step1TasksList = document.getElementById('step1-tasks');

    function updateStep1Tasks(){
      if(!step1TasksList) return;

      // Evaluate conditions
      const conditions = {
        insurer: insurerSelect?.value !== '',
        dates: !!(fromInput?.value && toInput?.value),
        scope: false,
        team: Array.from(teamCheckboxes).some(cb => cb.checked),
        create: step1Created
      };

      // Check scope: either template selected OR manual categories selected
      if(modeTemplate?.checked){
        conditions.scope = templateSelect?.value !== '';
      } else if(modeManual?.checked){
        const selectedOptions = dataCatsSelect ? Array.from(dataCatsSelect.selectedOptions) : [];
        conditions.scope = selectedOptions.length > 0;
      }

      // Update each task icon
      Object.entries(conditions).forEach(([taskName, isDone]) => {
        const taskEl = step1TasksList.querySelector(`[data-task="${taskName}"]`);
        if(!taskEl) return;
        const icon = taskEl.querySelector('.task-icon');
        if(icon){
          icon.textContent = isDone ? '✓' : '✕';
          icon.classList.remove(isDone ? 'status-pending' : 'status-done');
          icon.classList.add(isDone ? 'status-done' : 'status-pending');
        }
      });

      // Check if all tasks are done
      const allDone = Object.values(conditions).every(v => v === true);
      const chip = document.querySelector('.stage-chip[data-step="1"]');
      const navStep = document.querySelector('.steps .step[data-step="1"]');

      if(allDone){
        if(chip) chip.style.display = 'inline-block';
        if(navStep) navStep.classList.add('done');
      } else {
        if(chip) chip.style.display = 'none';
        if(navStep) navStep.classList.remove('done');
      }
    }

    // Attach change listeners
    insurerSelect?.addEventListener('change', updateStep1Tasks);
    fromInput?.addEventListener('change', updateStep1Tasks);
    toInput?.addEventListener('change', updateStep1Tasks);
    templateSelect?.addEventListener('change', updateStep1Tasks);
    dataCatsSelect?.addEventListener('change', updateStep1Tasks);
    modeTemplate?.addEventListener('change', updateStep1Tasks);
    modeManual?.addEventListener('change', updateStep1Tasks);
    teamCheckboxes.forEach(cb => cb.addEventListener('change', updateStep1Tasks));

    // Create button click
    if(createBtn){
      createBtn.addEventListener('click', function(e){
        const insurer = insurerSelect?.value;
        const from    = fromInput?.value;
        const to      = toInput?.value;
        const chosen  = Array.from(teamCheckboxes).filter(b=>b.checked).map(b=>b.value);

        if(!insurer || !from || !to || chosen.length===0){
          alert('Fill insurer, dates, and team.');
          return;
        }

        // Mark as created and update tasks
        step1Created = true;
        updateStep1Tasks();

        // Original logic
        const active = document.getElementById('kpi-active');
        if(active) active.textContent = String((+active.textContent||0)+1);
        gotoStep(2);
      });
    }

    // Initialize on load (show all as pending initially)
    updateStep1Tasks();
  })();
});
</script>
</body>
</html>
